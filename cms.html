<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Rahul Gutenberg Studio</title>

<link href="https://unpkg.com/grapesjs/dist/css/grapes.min.css" rel="stylesheet"/>
<script src="https://unpkg.com/grapesjs"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#f0f0f1;
}

/* ===== TOPBAR ===== */
.topbar{
  height:60px;
  background:#fff;
  border-bottom:1px solid #ddd;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
}

.topbar input{
  border:none;
  font-size:20px;
  font-weight:500;
  outline:none;
  width:400px;
  text-align:center;
}

.topbar button{
  background:#0073aa;
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:4px;
  cursor:pointer;
  margin-left:8px;
}

/* ===== LAYOUT ===== */
.layout{
  display:flex;
  height:calc(100vh - 60px);
}

/* ===== LEFT BLOCK PANEL ===== */
.sidebar{
  width:240px;
  background:white;
  border-right:1px solid #ddd;
  padding:20px;
  overflow:auto;
}

.sidebar button{
  width:100%;
  padding:10px;
  margin-bottom:8px;
  background:white;
  border:1px solid #ddd;
  text-align:left;
  cursor:pointer;
}

.sidebar button:hover{
  background:#f3f4f6;
}

/* ===== RIGHT SETTINGS ===== */
.settings{
  width:260px;
  background:white;
  border-left:1px solid #ddd;
  padding:20px;
}

/* ===== EDITOR ===== */
.editor-area{
  flex:1;
  background:#dcd2c2;
  display:flex;
  justify-content:center;
  overflow:auto;
}

#gjs{
  width:780px;
  padding:60px 40px;
  background:#dcd2c2;
  min-height:100%;
}

/* Remove default grapes UI */
.gjs-pn-panel{ display:none !important; }
.gjs-cv-canvas{ background:#dcd2c2 !important; }

/* Floating Toolbar */
.floating-toolbar{
  position:absolute;
  background:#111;
  color:white;
  padding:6px 8px;
  border-radius:6px;
  display:none;
  z-index:1000;
}

.floating-toolbar button{
  background:none;
  border:none;
  color:white;
  margin:0 5px;
  cursor:pointer;
}

/* Slash Menu */
.slash-menu{
  position:absolute;
  background:white;
  border:1px solid #ddd;
  padding:8px;
  display:none;
  z-index:1000;
  width:200px;
}
.slash-menu div{
  padding:6px;
  cursor:pointer;
}
.slash-menu div:hover{
  background:#f3f4f6;
}
</style>
</head>

<body>

<div class="topbar">
  <div>â˜°</div>
  <input type="text" id="docTitle" placeholder="Add title">
  <div>
    <button onclick="save()">Save</button>
    <button onclick="publish()">Publish</button>
  </div>
</div>

<div class="layout">

  <!-- LEFT BLOCKS -->
  <div class="sidebar">
    <h3>Blocks</h3>
    <button onclick="addBlock('p')">Paragraph</button>
    <button onclick="addBlock('h2')">Heading</button>
    <button onclick="addBlock('image')">Image</button>
    <button onclick="addBlock('quote')">Quote</button>
    <button onclick="addBlock('list')">List</button>
  </div>

  <!-- EDITOR -->
  <div class="editor-area">
    <div id="gjs"></div>
  </div>

  <!-- RIGHT SETTINGS -->
  <div class="settings">
    <h3>Block Settings</h3>
    <label>Font Size</label>
    <input type="range" min="14" max="40" onchange="changeFont(this.value)">
  </div>

</div>

<!-- Floating Toolbar -->
<div class="floating-toolbar" id="toolbar">
  <button onclick="format('bold')"><b>B</b></button>
  <button onclick="format('italic')"><i>I</i></button>
  <button onclick="format('underline')"><u>U</u></button>
</div>

<!-- Slash Menu -->
<div class="slash-menu" id="slashMenu">
  <div onclick="addBlock('h2')">Heading</div>
  <div onclick="addBlock('image')">Image</div>
  <div onclick="addBlock('quote')">Quote</div>
</div>

<script>

const editor = grapesjs.init({
  container:'#gjs',
  height:'100%',
  storageManager:false,
});

/* BLOCKS */

function addBlock(type){
  if(type==='p') editor.addComponents(`<p contenteditable="true">Start writing...</p>`);
  if(type==='h2') editor.addComponents(`<h2 contenteditable="true">Heading</h2>`);
  if(type==='image') editor.addComponents(`<img src="https://via.placeholder.com/700x300" style="max-width:100%">`);
  if(type==='quote') editor.addComponents(`<blockquote contenteditable="true">Quote text...</blockquote>`);
  if(type==='list') editor.addComponents(`<ul><li contenteditable="true">List item</li></ul>`);
}

/* SAVE */

function save(){
  localStorage.setItem("doc", editor.getHtml());
  alert("Saved");
}

function publish(){
  const element=document.createElement("div");
  element.innerHTML="<h1>"+document.getElementById("docTitle").value+"</h1>"+editor.getHtml();
  html2pdf().from(element).save("document.pdf");
}

/* FLOATING TOOLBAR */

document.addEventListener("mouseup",function(e){
  const selection=window.getSelection();
  if(selection.toString().length>0){
    const rect=selection.getRangeAt(0).getBoundingClientRect();
    const toolbar=document.getElementById("toolbar");
    toolbar.style.display="block";
    toolbar.style.top=(rect.top-40)+"px";
    toolbar.style.left=rect.left+"px";
  } else {
    document.getElementById("toolbar").style.display="none";
  }
});

function format(cmd){
  document.execCommand(cmd,false,null);
}

/* SLASH COMMAND */

document.addEventListener("keydown",function(e){
  if(e.key==="/"){
    const menu=document.getElementById("slashMenu");
    menu.style.display="block";
    menu.style.top=(window.innerHeight/2)+"px";
    menu.style.left=(window.innerWidth/2 - 100)+"px";
  }
});

/* CHANGE FONT */

function changeFont(size){
  document.execCommand("fontSize",false,"7");
  const fonts=document.getElementsByTagName("font");
  for(let i=0;i<fonts.length;i++){
    if(fonts[i].size=="7"){
      fonts[i].removeAttribute("size");
      fonts[i].style.fontSize=size+"px";
    }
  }
}

/* LOAD */

window.onload=function(){
  const saved=localStorage.getItem("doc");
  if(saved) editor.setComponents(saved);
};

</script>

</body>
</html>
