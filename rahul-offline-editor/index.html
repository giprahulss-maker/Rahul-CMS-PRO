<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Rahul Offline Block Editor</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#f0f0f1;
}

/* TOPBAR */
.topbar{
  height:60px;
  background:white;
  border-bottom:1px solid #ddd;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
}

.topbar input{
  border:none;
  font-size:20px;
  font-weight:500;
  outline:none;
  width:400px;
  text-align:center;
}

/* LAYOUT */
.layout{
  display:flex;
  height:calc(100vh - 60px);
}

/* SIDEBAR */
.sidebar{
  width:220px;
  background:white;
  border-right:1px solid #ddd;
  padding:15px;
}

.sidebar button{
  width:100%;
  padding:8px;
  margin-bottom:8px;
  border:1px solid #ddd;
  background:white;
  cursor:pointer;
}

.sidebar button:hover{
  background:#eee;
}

/* EDITOR */
.editor{
  flex:1;
  background:#dcd2c2;
  display:flex;
  justify-content:center;
  overflow:auto;
}

.canvas{
  width:760px;
  padding:60px 40px;
  min-height:100%;
}

/* BLOCK */
.block{
  padding:5px;
  margin-bottom:10px;
}

.block.selected{
  outline:2px solid #0073aa;
}

/* FLOATING TOOLBAR */
.toolbar{
  position:absolute;
  background:#111;
  color:white;
  padding:6px 10px;
  border-radius:6px;
  display:none;
}

.toolbar button{
  background:none;
  border:none;
  color:white;
  margin:0 4px;
  cursor:pointer;
}

/* SLASH MENU */
.slash{
  position:absolute;
  background:white;
  border:1px solid #ddd;
  display:none;
  padding:5px;
}
.slash div{
  padding:5px;
  cursor:pointer;
}
.slash div:hover{
  background:#eee;
}
</style>
</head>

<body>

<div class="topbar">
  <div>Offline Block Editor</div>
  <input type="text" id="title" placeholder="Add title">
  <button onclick="save()">Save</button>
</div>

<div class="layout">

  <div class="sidebar">
    <button onclick="addBlock('p')">Paragraph</button>
    <button onclick="addBlock('h2')">Heading</button>
    <button onclick="addBlock('image')">Image</button>
    <button onclick="addBlock('quote')">Quote</button>
    <button onclick="addBlock('list')">List</button>
  </div>

  <div class="editor">
    <div class="canvas" id="canvas"></div>
  </div>

</div>

<div class="toolbar" id="toolbar">
  <button onclick="format('bold')">B</button>
  <button onclick="format('italic')">I</button>
  <button onclick="format('underline')">U</button>
</div>

<div class="slash" id="slash">
  <div onclick="addBlock('h2')">Heading</div>
  <div onclick="addBlock('image')">Image</div>
  <div onclick="addBlock('quote')">Quote</div>
</div>

<script>

let selectedBlock=null;

function addBlock(type){
  const canvas=document.getElementById("canvas");
  let el;

  if(type==="p") el=document.createElement("p");
  if(type==="h2") el=document.createElement("h2");
  if(type==="image"){
    el=document.createElement("img");
    el.src="https://via.placeholder.com/700x300";
    el.style.maxWidth="100%";
  }
  if(type==="quote") el=document.createElement("blockquote");
  if(type==="list"){
    el=document.createElement("ul");
    el.innerHTML="<li>List item</li>";
  }

  if(type!=="image"){
    el.contentEditable=true;
    el.innerText="Edit text...";
  }

  el.classList.add("block");
  el.onclick=function(e){
    selectBlock(el);
    e.stopPropagation();
  }

  canvas.appendChild(el);
}

/* SELECT BLOCK */

function selectBlock(el){
  document.querySelectorAll(".block").forEach(b=>b.classList.remove("selected"));
  el.classList.add("selected");
  selectedBlock=el;
}

/* CLICK OUTSIDE */

document.body.onclick=function(){
  document.querySelectorAll(".block").forEach(b=>b.classList.remove("selected"));
  selectedBlock=null;
}

/* TOOLBAR */

document.addEventListener("mouseup",function(){
  const selection=window.getSelection();
  if(selection.toString().length>0){
    const rect=selection.getRangeAt(0).getBoundingClientRect();
    const tb=document.getElementById("toolbar");
    tb.style.display="block";
    tb.style.top=(rect.top-40)+"px";
    tb.style.left=rect.left+"px";
  } else {
    document.getElementById("toolbar").style.display="none";
  }
});

function format(cmd){
  document.execCommand(cmd,false,null);
}

/* SLASH COMMAND */

document.addEventListener("keydown",function(e){
  if(e.key==="/"){
    const menu=document.getElementById("slash");
    menu.style.display="block";
    menu.style.top=(window.innerHeight/2)+"px";
    menu.style.left=(window.innerWidth/2)+"px";
  }
});

/* SAVE */

function save(){
  const data=document.getElementById("canvas").innerHTML;
  localStorage.setItem("rahulDoc",data);
  alert("Saved offline");
}

window.onload=function(){
  const data=localStorage.getItem("rahulDoc");
  if(data) document.getElementById("canvas").innerHTML=data;
};

</script>

</body>
</html>
