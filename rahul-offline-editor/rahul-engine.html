<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Rahul Offline Editor v1</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#f4f4f4;
}

/* ===== TOPBAR ===== */

.topbar{
  height:60px;
  background:white;
  border-bottom:1px solid #ddd;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
}

.topbar button{
  padding:6px 12px;
  cursor:pointer;
}

/* ===== LAYOUT ===== */

.layout{
  display:flex;
  height:calc(100vh - 60px);
}

/* SIDEBAR */

.sidebar{
  width:220px;
  background:white;
  border-right:1px solid #ddd;
  padding:10px;
}

.sidebar button{
  width:100%;
  margin-bottom:8px;
  padding:8px;
  cursor:pointer;
}

/* CANVAS */

.canvas{
  flex:1;
  padding:50px;
  overflow:auto;
}

.block{
  background:white;
  padding:10px;
  margin-bottom:10px;
  border:1px solid transparent;
}

.block.selected{
  border:1px solid #0073aa;
}
</style>
</head>
<body>

<div class="topbar">
  <strong>Rahul Editor</strong>
  <div>
    <button onclick="editor.addBlock('paragraph')">+ Paragraph</button>
    <button onclick="editor.addBlock('heading')">+ Heading</button>
    <button onclick="downloadHTML()">Save as HTML</button>
  </div>
</div>

<div class="layout">
  <div class="sidebar">
    <h4>Blocks</h4>
    <button onclick="editor.addBlock('paragraph')">Paragraph</button>
    <button onclick="editor.addBlock('heading')">Heading</button>
  </div>

  <div class="canvas" id="canvas"></div>
</div>

<script>

/* ===========================
   BLOCK REGISTRY
=========================== */

const BlockRegistry = {

  paragraph:{
    create(){
      return {
        type:"paragraph",
        content:"New paragraph..."
      };
    },

    render(block,index){
      return `
        <div class="block" data-index="${index}">
          <p contenteditable="true">${block.content}</p>
        </div>
      `;
    }
  },

  heading:{
    create(){
      return {
        type:"heading",
        level:2,
        content:"New heading"
      };
    },

    render(block,index){
      return `
        <div class="block" data-index="${index}">
          <h${block.level} contenteditable="true">${block.content}</h${block.level}>
        </div>
      `;
    }
  }

};


/* ===========================
   EDITOR ENGINE
=========================== */

class Editor{

  constructor(){
    this.blocks = [];
  }

  addBlock(type){
    const block = BlockRegistry[type].create();
    this.blocks.push(block);
    this.render();
  }

  render(){
    const canvas = document.getElementById("canvas");

    canvas.innerHTML = this.blocks
      .map((block,index)=>{
        return BlockRegistry[block.type].render(block,index);
      })
      .join("");

    this.attachEvents();
  }

  attachEvents(){

    document.querySelectorAll(".block").forEach(el=>{

      el.onclick = (e)=>{
        document.querySelectorAll(".block")
          .forEach(b=>b.classList.remove("selected"));
        el.classList.add("selected");
        e.stopPropagation();
      };

      const index = el.dataset.index;
      const editable = el.querySelector("[contenteditable]");

      editable.oninput = ()=>{
        this.blocks[index].content = editable.innerText;
      };

    });

  }

}

/* ===========================
   EXPORT HTML FILE
=========================== */

function downloadHTML(){

  let bodyContent = editor.blocks.map(block=>{

    if(block.type==="paragraph"){
      return `<p>${block.content}</p>`;
    }

    if(block.type==="heading"){
      return `<h${block.level}>${block.content}</h${block.level}>`;
    }

  }).join("\n");

  const fullHTML = `
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Exported Document</title>
<style>
body{ font-family:system-ui; padding:40px; }
</style>
</head>
<body>

${bodyContent}

</body>
</html>
`;

  const blob = new Blob([fullHTML], {type:"text/html"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "document.html";
  a.click();
}


/* ===========================
   INITIALIZE
=========================== */

const editor = new Editor();

</script>
</body>
</html>
